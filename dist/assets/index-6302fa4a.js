var L=Object.defineProperty;var V=(u,t,e)=>t in u?L(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var l=(u,t,e)=>(V(u,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const R="modulepreload",N=function(u){return"/"+u},S={},O=function(t,e,s){if(!e||e.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(e.map(o=>{if(o=N(o),o in S)return;S[o]=!0;const h=o.endsWith(".css"),a=h?'[rel="stylesheet"]':"";if(!!s)for(let n=r.length-1;n>=0;n--){const m=r[n];if(m.href===o&&(!h||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const i=document.createElement("link");if(i.rel=h?"stylesheet":R,h||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),h)return new Promise((n,m)=>{i.addEventListener("load",n),i.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())};class z{static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static crossProduct(t,e){return new p(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static rotate(t,e,s,r){const o=Math.cos(s),h=Math.sin(s),a=Math.cos(r),c=Math.sin(r),i=t.x-e.x,n=t.y-e.y,m=t.z-e.z;return new x(o*i-h*a*m+h*c*n+e.x,h*i+o*a*m-o*c*n+e.z,c*m+a*n+e.y)}static norm(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}static vectorAngle(t,e){return this.dotProduct(t,e)/(this.norm(t)*this.norm(e))}}function C(u){return typeof u=="number"}const b=class{constructor(t,e,s){l(this,"x");l(this,"y");l(this,"z");C(t)&&C(e)&&C(s)?(this.x=t,this.y=e,this.z=s):b.isVector(t)&&b.isVector(e)&&(this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z)}static isVector(t){return C(t.x)&&C(t.y)&&C(t.z)}normalize(t=1){const e=z.norm(this)/t;return new b(this.x/e,this.y/e,this.z/e)}toVertex3D(){return new x(this.x,this.y,this.z)}rotate(t,e,s){const r=Math.sin(t),o=Math.cos(t),h=Math.sin(e),a=Math.cos(e),c=Math.sin(s),i=Math.cos(s),n=this.x*(a*i)+this.y*(a*c)+this.z*-h,m=this.x*(r*h*i-o*c)+this.y*(r*h*c+o*i)+this.z*(r*a),A=this.x*(o*h*i+r*c)+this.y*(o*h*c-r*i)+this.z*(o*a);return new b(n,m,A)}move(t,e,s){this.x+=t,this.y+=e,this.z+=s}jump(t,e,s){this.x=t,this.y=e,this.z=s}};let p=b;l(p,"Up",new b(0,1,0));class x{constructor(t,e,s){l(this,"x");l(this,"y");l(this,"z");this.x=t,this.y=e,this.z=s}toVector(){return new p(this.x,this.y,this.z)}move(t,e,s){this.x+=t,this.y+=e,this.z+=s}jump(t,e,s){this.x=t,this.y=e,this.z=s}subtract(t){return new x(this.x-t.x,this.y-t.y,this.z-t.z)}normalize(){return this.toVector().normalize()}rotate(t,e,s){return z.rotate(this,t,e,s)}}class E{constructor(t,e){l(this,"x");l(this,"y");this.x=t,this.y=e}}const f=class{constructor(t,e,s,r){l(this,"r");l(this,"g");l(this,"b");l(this,"a");this.r=t,this.g=e,this.b=s,this.a=r||1}get(t=1){return`rgba(${Math.floor(this.r*t)},${Math.floor(this.g*t)},${Math.floor(this.b*t)},${this.a})`}};let d=f;l(d,"red",new f(255,0,0)),l(d,"green",new f(0,255,0)),l(d,"blue",new f(0,0,255)),l(d,"yellow",new f(255,255,0)),l(d,"pink",new f(255,20,147)),l(d,"orange",new f(255,99,71)),l(d,"cyan",new f(0,255,255)),l(d,"purple",new f(255,0,255));class k{constructor(t=[],e){l(this,"objects");l(this,"camera");this.objects=t,this.camera=e}appear(t){this.objects=[...this.objects,...t]}setCamera(t){this.camera=t}move(t,e,s){this.objects.forEach(r=>r.move(t,e,s))}rotate(t,e){this.objects.forEach(s=>s.rotate(t,e,new x(0,0,0)))}convertToCameraCoordSystem(){return new k(this.objects.map(t=>this.camera.modelToCameraCoordSystem(t)),this.camera)}zsort(){return this.objects.slice().sort((t,e)=>e.getCenter().z-t.getCenter().z)}}class w{constructor(t,e,s,r){l(this,"vertex1");l(this,"vertex2");l(this,"vertex3");l(this,"color");this.vertex1=t,this.vertex2=e,this.vertex3=s,this.color=r}getCenter(){const t=(this.vertex1.x+this.vertex2.x+this.vertex3.x)/3,e=(this.vertex1.y+this.vertex2.y+this.vertex3.y)/3,s=(this.vertex1.z+this.vertex2.z+this.vertex3.z)/3;return new x(t,e,s)}getNormalVector(){return z.crossProduct(new p(this.vertex1.toVector(),this.vertex2.toVector()),new p(this.vertex2.toVector(),this.vertex3.toVector()))}}class M{constructor(t,e){l(this,"vertices");l(this,"faces");this.vertices=t,this.faces=e}getCenter(){let t=0,e=0,s=0;this.vertices.forEach(o=>{t+=o.x,e+=o.y,s+=o.z});const r=this.vertices.length;return new x(t/r,e/r,s/r)}rotate(t,e,s=this.getCenter()){const r=Math.cos(t),o=Math.sin(t),h=Math.cos(e),a=Math.sin(e);this.vertices.forEach(c=>{const i=c.x-s.x,n=c.y-s.y,m=c.z-s.z;c.x=r*i-o*h*m+o*a*n+s.x,c.z=o*i+r*h*m-r*a*n+s.z,c.y=a*m+h*n+s.y})}move(t,e,s){this.vertices.forEach(r=>{r.x+=t,r.y+=e,r.z+=s})}zsort(){return this.faces.slice().sort((t,e)=>e.getCenter().z-t.getCenter().z)}mergeModel(t){this.faces=[...this.faces,...t.faces],this.vertices=[...this.vertices,...t.vertices]}}function $(u){const t=u.vertics.map(s=>new x(s.x,s.y,s.z)),e=u.faces.map(s=>new w(t[s[0]],t[s[1]],t[s[2]],d.orange));return new M(t,e)}function D(u,t){q(t),U(u,t)}function U(u,t){u.zsort().forEach(e=>I(e,u.camera,t))}function I(u,t,e){u.zsort().forEach(s=>B(s,t,e))}function B(u,t,e){const{light:s=new p(100,-100,100)}=e;if(!t.culling(u))return;const r=u.color.get(1-(z.vectorAngle(u.getNormalVector(),s)+1)/2),o=t.project(u.vertex1),h=t.project(u.vertex2),a=t.project(u.vertex3);F(o,h,a,r,e)}function q(u){const{context:t,canvasSize:e}=u,{width:s,height:r}=e;t.clearRect(0,0,s,r)}function F(u,t,e,s,r){const{context:o,canvasSize:h}=r,a=h.width/2,c=h.height/2;o.beginPath(),o.moveTo(u.x+a,-u.y+c),o.lineTo(t.x+a,-t.y+c),o.lineTo(e.x+a,-e.y+c),o.closePath(),o.strokeStyle=s,o.stroke(),o.fillStyle=s,o.fill()}class X{constructor(t,e){l(this,"position");l(this,"lookAt");l(this,"context");this.position=t,this.lookAt=e,this.calcCameraContext()}calcCameraContext(){const t=this.position.subtract(this.lookAt).normalize(),e=z.crossProduct(p.Up,t).normalize(),s=z.crossProduct(t,e),r={x:-z.dotProduct(e,this.position),y:-z.dotProduct(s,this.position),z:-z.dotProduct(t,this.position)};this.context={xAxis:e,yAxis:s,zAxis:t,translation:r}}toCameraCoordSystem(t){const{xAxis:e,yAxis:s,zAxis:r,translation:o}=this.context,h=z.dotProduct(t,e)+o.x,a=z.dotProduct(t,s)+o.y,c=z.dotProduct(t,r)+o.z;return new x(h,a,c)}faceToCameraCoordSystem(t){return new w(this.toCameraCoordSystem(t.vertex1),this.toCameraCoordSystem(t.vertex2),this.toCameraCoordSystem(t.vertex3),t.color)}modelToCameraCoordSystem(t){return new M(t.vertices,t.faces.map(e=>this.faceToCameraCoordSystem(e)))}culling(t){return t.getCenter().z>this.position.z}move(t,e,s){this.position.move(t,e,s)}jump(t){this.position.jump(t.x,t.y,t.z)}getCenter(){return this.position}}class Y extends X{constructor(e,s,r){super(e,s);l(this,"distance");this.distance=r}project(e){const s=this.distance/(e.z-this.position.z||1);return new E(s*(e.x-this.position.x),s*(e.y-this.position.y))}culling(e){return super.culling(e)&&this.perspectiveCurring(e)}perspectiveCurring(e){return z.vectorAngle(e.getNormalVector().normalize(),new p(this.position,this.lookAt))<0}}class Z extends Y{project({x:t,y:e,z:s}){const r=this.distance/(s-this.position.z||1);return new E(r*(t-this.position.x),r*(e-this.position.y))}}class W extends M{constructor(t,e,s,r,o){const h=e/2,a=s/2,c=r/2,i=t,n=[new x(i.x-h,i.y-a,i.z-c),new x(i.x+h,i.y-a,i.z-c),new x(i.x-h,i.y-a,i.z+c),new x(i.x+h,i.y-a,i.z+c),new x(i.x-h,i.y+a,i.z-c),new x(i.x+h,i.y+a,i.z-c),new x(i.x-h,i.y+a,i.z+c),new x(i.x+h,i.y+a,i.z+c)],m=[new w(n[0],n[1],n[2],d.red),new w(n[1],n[3],n[2],d.red),new w(n[2],n[3],n[6],d.green),new w(n[6],n[3],n[7],d.green),new w(n[1],n[5],n[3],d.blue),new w(n[5],n[7],n[3],d.blue),new w(n[4],n[6],n[5],d.purple),new w(n[5],n[6],n[7],d.purple),new w(n[0],n[2],n[6],d.yellow),new w(n[0],n[6],n[4],d.yellow),new w(n[0],n[4],n[1],d.pink),new w(n[1],n[4],n[5],d.pink)];super(n,m)}}class J extends M{constructor(t,e,s,r){const o=e/2,h=s/2,a=t,c=[new x(a.x-o,a.y,a.z-h),new x(a.x+o,a.y,a.z-h),new x(a.x-o,a.y,a.z+h),new x(a.x+o,a.y,a.z+h)],i=[new w(c[2],c[1],c[0],r),new w(c[2],c[3],c[1],r),new w(c[0],c[1],c[2],r),new w(c[1],c[3],c[2],r)];super(c,i)}}async function G(){const u=await O(()=>import("./Cup-98323de7.js"),[]),t=$(u);t.move(0,0,2),t.move(0,0,5);const e=document.getElementById("canvas").getContext("2d"),s=new W(new x(0,0,100),60,60,60,d.red);new J(new x(0,10,100),60,60,d.red);const r=[t],o=new Z(new x(0,0,0),new x(0,0,10),300),h=new k(r,o);function a(){r[0].rotate(Math.PI/360,Math.PI/720),setTimeout(a,10)}a();let c;(y=>{y.Up="ArrowUp",y.Down="ArrowDown",y.Right="ArrowRight",y.Left="ArrowLeft",y.W="w",y.A="a",y.S="s",y.D="d",y.NONE=""})(c||(c={}));let i="";document.addEventListener("keydown",y=>{i=y.key});function n(){let y=0,P=0,g=0,v=0;switch(i){case"ArrowLeft":y+=1;break;case"ArrowUp":P+=1;break;case"ArrowRight":y-=1;break;case"ArrowDown":P-=1;break;case"w":v+=1;break;case"s":v-=1;break;case"a":g+=1;break;case"d":g-=1;break;default:setTimeout(n,1e3/30);return}i="",o.position.move(y,0,P),o.lookAt.move(g,0,v),console.log(o.position,o.lookAt,r[0].getCenter()),setTimeout(n,1e3/30)}n();const m=document.getElementById("debug").getContext("2d");function A(){D(h,{context:e,canvasSize:{width:500,height:500}}),j(),setTimeout(A,1e3/30)}A();function j(){const y=[s.getCenter(),o.position,o.lookAt,t.getCenter()].map(({x:g,z:v})=>({x:g,z:v}));m.clearRect(0,0,500,500);const P=["black","blue","red","purple"];y.forEach(({x:g,z:v},T)=>{m.fillStyle=`${P[T]}`,m.fillRect(250-g,250-v,4,4)})}}G();
